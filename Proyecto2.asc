* PROYECTO 2

*DECLARACION CONSTANTES

SCDR   EQU   $102F
SCCR2  EQU   $102D
SCSR   EQU   $102E
SCCR1  EQU   $102C
BAUD   EQU   $102B
HPRIO  EQU   $103C
SPCR   EQU   $1028
CSCTL  EQU   $105D
OPT2   EQU   $1038
DDRD   EQU   $1009

*DECLARACION DE VARIABLES
*9999 = IXCMXCIX
ORDEN EQU $0000
M   EQU $0016  *BANDERA DE LETRAS M
D   EQU $0017  *BANDERA DE LETRA D
C   EQU $0018  *BANDERA DE LETRA C
L   EQU $0019  *BANDERA DE LETRA L
XB   EQU $0020  *BANDERA DE LETRA X
V   EQU $0021  *BANDERA DE LETRA U
I   EQU $0022  *BANDERA DE LETRA I
O   EQU $0023  *BANDERA DEL OK
A	EQU $0001  *BANDERA FIN DE CADENA
UNIDAD EQU $0073
DECENA EQU $0072
CENTENA EQU $0071
MIL EQU $0070

  		ORG $8000
INICIO
		LDS #$00FF
		JSR SERIAL
		JMP LIMPIEZA
      

CICLATE
		LDAA	#'?
		STAA	ORDEN
CICLO
		LDAA	ORDEN
		CMPA	#'?
		BEQ	CICLO
        
        CMPA #'M
        BEQ CASOM
        CMPA #'D
        BEQ CASOD
        CMPA #'C
        BEQ CASOC
        CMPA #'L
        BEQ CASOL
        JMP SALTOINTERMEDIO

CASOM
		STAA $00,X
		INX
		LDAB C
      	CMPB #1
      	BEQ CASOM1
      	LDAB M
      	INCB 
      	STAB M
      	LDAB MIL
      	INCB 
      	STAB MIL
      	JMP CICLATE

*CASO DONDE LLEGUE CM
CASOM1
		LDAB #9
      	STAB CENTENA
      	JMP CICLATE

CASOD
		STAA $00,X
		INX
      	LDAB C
      	CMPB #1
      	BEQ CASOD1
      	LDAB D
      	INCB 
      	STAB D
      	LDAB #5
      	STAB CENTENA
      	JMP CICLATE

CASOD1
      	LDAB #4
      	STAB CENTENA
      	JMP CICLATE

*C ES UNA BANDERA A FUTURO PARA ERRORES
CASOC
		STAA $00,X
		INX
		LDAB XB
		CMPB #1
		BEQ CASOC1
     	LDAB C
     	INCB 
      	STAB C
		LDAB CENTENA
     	INCB 
      	STAB CENTENA
      	JMP CICLATE

*CASO POR SI LLEGA UN XC
CASOC1
		LDAB #9
		STAB DECENA
		JMP CICLATE

CASOL
		STAA $00,X
		INX
		LDAB XB
		CMPB #1
		BEQ CASOL1
      	LDAB L
      	INCB 
      	STAB L
		LDAB #5
      	STAB DECENA
      	JMP CICLATE

*PARA CUANDO LLEGA XL
CASOL1
		LDAB #4
		STAB DECENA
		JMP CICLATE

SALTOINTERMEDIO
		CMPA #'X
        BEQ CASOX
        CMPA #'V
        BEQ CASOV
        CMPA #'I
        BEQ CASOI

        CMPA #'O  *CASO EN QUE RECIBA OK
        BEQ CASOO
        CMPA #'K
        BEQ CASOOK
		CMPA #32
		BEQ ESCRIBECHAR
		JMP CICLATE

CASOX
		STAA $00,X
		INX
		LDAB I
		CMPB #1
		BEQ CASOX1
      	LDAB XB
      	INCB 
      	STAB XB
		LDAB DECENA
		INCB
		STAB DECENA
      	JMP CICLATE

*CUANDO LLEGUE UN IX
CASOX1
		LDAB #9
		STAB UNIDAD
		JMP CICLATE

CASOV
		STAA $00,X
		INX
		LDAB I
		CMPB #1
		BEQ CASOV1
		LDAB V
		INCB 
		STAB V
		LDAB #5
		STAB UNIDAD
		JMP CICLATE

*CUANDO LLEGUE UN IV
CASOV1 
		LDAB #4
		STAB UNIDAD
		JMP CICLATE

CASOI
		STAA $00,X
		INX
		LDAB I
		INCB 
		STAB I
		LDAB UNIDAD
		INCB
		STAB UNIDAD
		JMP CICLATE

CASOO
		LDAB O
		INCB
		STAB O
		JMP FIN

CASOOK
		LDAB O
		CMPB #0
		BNE LIMPIEZA
		JMP CICLATE


ESCRIBECHAR
		LDAB #48
		LDAA MIL
		ABA
		STAA MIL
		LDAA CENTENA
		ABA
		STAA CENTENA
		LDAA DECENA
		ABA
		STAA DECENA
		LDAA UNIDAD
		ABA
		STAA UNIDAD
		JMP FIN

FIN 
		LDAA	#'?
		STAA	ORDEN
CICLO1
		LDAA	ORDEN
		CMPA	#'?
		BEQ	CICLO1
		CMPA #'O
		BEQ CASOO
		CMPA #'K
		BEQ CASOOK
		JMP FIN


SERIAL
       LDD   #$302C  * CONFIGURA PUERTO SERIAL
       STAA  BAUD    * BAUD  9600  para cristal de 8MHz
       STAB  SCCR2   * HABILITA  RX Y TX PERO INTERRUPCN SOLO RX
       LDAA  #$00
       STAA  SCCR1   * 8 BITS

       LDAA  #$FE    * CONFIG PUERTO D COMO SALIDAS (EXCEPTO PD0)
       STAA  DDRD    * SEA  ENABLE DEL DISPLAY  PD4  Y RS PD3
                     
      
       LDAA  #$04
       STAA  HPRIO

       LDAA  #$00
       TAP
      RTS


LIMPIEZA
	CLR M
	CLR D
	CLR C
	CLR L 
	CLR XB
	CLR V
	CLR I
	CLR A
	CLR UNIDAD
	CLR DECENA
	CLR CENTENA
	CLR MIL
	LDX #$0050
	LDY #$0050
LIM
	LDAA #00
	STAA $00,Y
	INY
	CPY #$006F
	BNE LIM
	JMP CICLATE

***********************************
* ATENCION A INTERRUPCION SERIAL
***********************************
	ORG	$F100
	LDAA	SCSR
	LDAA	SCDR
	STAA	ORDEN 
	RTI

***********************************
* VECTOR INTERRUPCION SERIAL
***********************************
	ORG	$FFD6
	FCB	$F1,$00       


***********************************
*RESET
***********************************
	ORG	$FFFE
RESET	FCB	$80,$00
***********************************

	END	$8000